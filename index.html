<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>NicheCom Equipment & Car Check</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.10.1/html2pdf.bundle.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/signature_pad@4.0.0/dist/signature_pad.umd.min.js"></script>

    <style>
        :root {
            --primary: #333;
            --border: #000;
        }
        body {
            font-family: Arial, sans-serif;
            background-color: #f0f0f0;
            margin: 0;
            padding: 20px;
        }
        .container {
            max-width: 1000px;
            margin: 0 auto;
            background: white;
            padding: 20px;
            box-shadow: 0 0 10px rgba(0,0,0,0.1);
        }
        
        /* TABS STYLING */
        .tabs {
            display: flex;
            margin-bottom: 20px;
            border-bottom: 2px solid #333;
        }
        .tab-btn {
            padding: 15px 30px;
            background: #ddd;
            border: none;
            cursor: pointer;
            font-weight: bold;
            font-size: 16px;
            margin-right: 5px;
            border-top-left-radius: 5px;
            border-top-right-radius: 5px;
        }
        .tab-btn.active {
            background: #333;
            color: white;
        }
        .tab-content {
            display: none;
            padding: 20px 0;
        }
        .tab-content.active {
            display: block;
        }

        /* FORM STYLING (Carbon Copy Look) */
        h2, h3 { margin-top: 0; border-bottom: 2px solid black; padding-bottom: 5px; }
        table {
            width: 100%;
            border-collapse: collapse;
            margin-bottom: 20px;
            font-size: 14px;
        }
        th, td {
            border: 1px solid black;
            padding: 8px;
            text-align: left;
        }
        th { background-color: #eee; }
        
        input[type="text"], input[type="date"], input[type="number"], select, textarea {
            width: 95%;
            padding: 5px;
            border: none;
            background: transparent;
            font-family: inherit;
        }
        /* Make inputs look like fillable areas */
        input:focus, textarea:focus {
            background-color: #eef;
            outline: none;
        }

        /* SPECIFIC LAYOUTS */
        .grid-2 { display: grid; grid-template-columns: 1fr 1fr; gap: 20px; }
        .grid-3 { display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 10px; }
        
        /* CAR DIAGRAM */
        .car-canvas-container {
            position: relative;
            width: 100%;
            height: 400px; /* Adjust based on your image aspect ratio */
            border: 1px solid black;
            background: url('images/car-diagram.png') no-repeat center center;
            background-size: contain;
            margin-bottom: 20px;
        }
        #carCanvas {
            width: 100%;
            height: 100%;
            cursor: crosshair;
        }

        /* SIGNATURES */
        .sig-wrapper {
            border: 1px dashed #333;
            background: #fffff0;
            margin-top: 5px;
            height: 100px;
            position: relative;
        }
        canvas.sig-pad { width: 100%; height: 100%; }
        .clear-btn {
            position: absolute;
            bottom: 5px;
            right: 5px;
            font-size: 10px;
            background: #eee;
            border: 1px solid #999;
            padding: 2px 5px;
            cursor: pointer;
        }

        /* ACTION BUTTONS */
        .actions {
            position: fixed;
            bottom: 20px;
            right: 20px;
            display: flex;
            gap: 10px;
            z-index: 999;
        }
        .action-btn {
            padding: 15px 25px;
            background: #007bff;
            color: white;
            border: none;
            border-radius: 50px;
            font-size: 16px;
            box-shadow: 0 4px 6px rgba(0,0,0,0.2);
            cursor: pointer;
        }
        .action-btn.reset { background: #dc3545; }

        @media print {
            .actions, .tabs { display: none; }
            .tab-content { display: block !important; } /* Print all tabs */
            body { background: white; padding: 0; }
            .container { box-shadow: none; max-width: 100%; }
        }
    </style>
</head>
<body>

<div class="actions">
    <button class="action-btn" onclick="generatePDF()">Download PDF</button>
</div>

<div class="container" id="printableArea">
    
    <div class="tabs">
        <button class="tab-btn active" onclick="switchTab('kit', this)">Kit Handover</button>
        <button class="tab-btn" onclick="switchTab('car', this)">Car Inspection</button>
    </div>

    <div id="kit" class="tab-content active">
        <h2>Kit Handover Checklist</h2>
        <p><strong>Manager:</strong> <input type="text" style="width:200px; border-bottom:1px solid #000"></p>

        <h3>OFFICE KIT</h3>
        <table>
            <tr>
                <th width="30%">Item</th>
                <th>Model/Type</th>
                <th>Serial No.</th>
                <th>Qty</th>
                <th>Cond (1-5)</th>
                <th>Notes</th>
            </tr>
            <tr><td>iPad</td><td><input type="text"></td><td><input type="text"></td><td><input type="number"></td><td><input type="number" min="1" max="5"></td><td><input type="text"></td></tr>
            <tr><td>Charger</td><td><input type="text"></td><td><input type="text"></td><td><input type="number"></td><td><input type="number" min="1" max="5"></td><td><input type="text"></td></tr>
            <tr><td>Mobile Phone</td><td><input type="text"></td><td><input type="text"></td><td><input type="number"></td><td><input type="number" min="1" max="5"></td><td><input type="text"></td></tr>
            <tr><td>Mobile Charger</td><td><input type="text"></td><td><input type="text"></td><td><input type="number"></td><td><input type="number" min="1" max="5"></td><td><input type="text"></td></tr>
            <tr><td>Fuel Card</td><td><input type="text"></td><td><input type="text"></td><td><input type="number"></td><td><input type="number" min="1" max="5"></td><td><input type="text"></td></tr>
        </table>

        <h3>FLOORPLAN / EPC KIT</h3>
        <table>
            <tr>
                <th width="30%">Item</th>
                <th>Model/Type</th>
                <th>Qty</th>
                <th>Cond (1-5)</th>
                <th>Notes</th>
            </tr>
            <tr><td>Disto</td><td><input type="text"></td><td><input type="number"></td><td><input type="number" min="1" max="5"></td><td><input type="text"></td></tr>
            <tr><td>Folder/Clipboard</td><td><input type="text"></td><td><input type="number"></td><td><input type="number" min="1" max="5"></td><td><input type="text"></td></tr>
            <tr><td>Backing sheet</td><td><input type="text"></td><td><input type="number"></td><td><input type="number" min="1" max="5"></td><td><input type="text"></td></tr>
            <tr><td>Ruler</td><td><input type="text"></td><td><input type="number"></td><td><input type="number" min="1" max="5"></td><td><input type="text"></td></tr>
            <tr><td>Measuring Wheel</td><td><input type="text"></td><td><input type="number"></td><td><input type="number" min="1" max="5"></td><td><input type="text"></td></tr>
            <tr><td>Compass</td><td><input type="text"></td><td><input type="number"></td><td><input type="number" min="1" max="5"></td><td><input type="text"></td></tr>
            <tr><td>Ladder</td><td><input type="text"></td><td><input type="number"></td><td><input type="number" min="1" max="5"></td><td><input type="text"></td></tr>
        </table>

        <h3>PHOTOGRAPHY KIT</h3>
        <table>
            <tr>
                <th width="30%">Item</th>
                <th>Model/Type</th>
                <th>Qty</th>
                <th>Cond (1-5)</th>
                <th>Notes</th>
            </tr>
            <tr><td>Camera Body</td><td>D800/D750/D780</td><td><input type="number"></td><td><input type="number" min="1" max="5"></td><td><input type="text"></td></tr>
            <tr><td>Batt & Charger</td><td><input type="text"></td><td><input type="number"></td><td><input type="number" min="1" max="5"></td><td><input type="text"></td></tr>
            <tr><td>Wide Lens</td><td>14-24mm/16-35mm</td><td><input type="number"></td><td><input type="number" min="1" max="5"></td><td><input type="text"></td></tr>
            <tr><td>50mm Lens</td><td><input type="text"></td><td><input type="number"></td><td><input type="number" min="1" max="5"></td><td><input type="text"></td></tr>
            <tr><td>Zoom Lens</td><td><input type="text"></td><td><input type="number"></td><td><input type="number" min="1" max="5"></td><td><input type="text"></td></tr>
            <tr><td>Tripod & Head</td><td><input type="text"></td><td><input type="number"></td><td><input type="number" min="1" max="5"></td><td><input type="text"></td></tr>
            <tr><td>Lens Cloth</td><td><input type="text"></td><td><input type="number"></td><td><input type="number" min="1" max="5"></td><td><input type="text"></td></tr>
            <tr><td>AAA Charger</td><td><input type="text"></td><td><input type="number"></td><td><input type="number" min="1" max="5"></td><td><input type="text"></td></tr>
            <tr><td>Rech. Batteries</td><td><input type="text"></td><td><input type="number"></td><td><input type="number" min="1" max="5"></td><td><input type="text"></td></tr>
            <tr><td>Cables/Reader</td><td><input type="text"></td><td><input type="number"></td><td><input type="number" min="1" max="5"></td><td><input type="text"></td></tr>
            <tr><td>SD Cards</td><td><input type="text"></td><td><input type="number"></td><td><input type="number" min="1" max="5"></td><td><input type="text"></td></tr>
            <tr><td>Camera Bag</td><td><input type="text"></td><td><input type="number"></td><td><input type="number" min="1" max="5"></td><td><input type="text"></td></tr>
        </table>

        <h3>MATTERPORT KIT</h3>
        <table>
             <tr><th width="30%">Item</th><th>Qty</th><th>Cond (1-5)</th><th>Notes</th></tr>
             <tr><td>Matterport Camera</td><td><input type="number"></td><td><input type="number" min="1" max="5"></td><td><input type="text"></td></tr>
             <tr><td>Pelicase</td><td><input type="number"></td><td><input type="number" min="1" max="5"></td><td><input type="text"></td></tr>
             <tr><td>Tripod Head</td><td><input type="number"></td><td><input type="number" min="1" max="5"></td><td><input type="text"></td></tr>
             <tr><td>Plate Adapter</td><td><input type="number"></td><td><input type="number" min="1" max="5"></td><td><input type="text"></td></tr>
             <tr><td>Powerpack</td><td><input type="number"></td><td><input type="number" min="1" max="5"></td><td><input type="text"></td></tr>
             <tr><td>4x Doorstops</td><td><input type="number"></td><td><input type="number" min="1" max="5"></td><td><input type="text"></td></tr>
        </table>
        
        <h3>ELEVATED KIT</h3>
        <table>
            <tr><th width="30%">Item</th><th>Qty</th><th>Cond (1-5)</th><th>Notes</th></tr>
            <tr><td>PhotoMast</td><td><input type="number"></td><td><input type="number" min="1" max="5"></td><td><input type="text"></td></tr>
            <tr><td>Phone Mount</td><td><input type="number"></td><td><input type="number" min="1" max="5"></td><td><input type="text"></td></tr>
            <tr><td>CamRanger</td><td><input type="number"></td><td><input type="number" min="1" max="5"></td><td><input type="text"></td></tr>
            <tr><td>USB Cable</td><td><input type="number"></td><td><input type="number" min="1" max="5"></td><td><input type="text"></td></tr>
            <tr><td>CamRanger Bag</td><td><input type="number"></td><td><input type="number" min="1" max="5"></td><td><input type="text"></td></tr>
       </table>

        <div class="grid-2">
            <div>
                <p><strong>Manager Name:</strong> <input type="text"></p>
                <div class="sig-wrapper">
                    <canvas id="sig-manager-kit" class="sig-pad"></canvas>
                    <button class="clear-btn" onclick="clearSig('sig-manager-kit')">Clear</button>
                </div>
                <p>Date: <input type="date"></p>
            </div>
            <div>
                <p><strong>Photographer Name:</strong> <input type="text"></p>
                <div class="sig-wrapper">
                    <canvas id="sig-photo-kit" class="sig-pad"></canvas>
                    <button class="clear-btn" onclick="clearSig('sig-photo-kit')">Clear</button>
                </div>
                <p>Date: <input type="date"></p>
            </div>
        </div>
        <p><strong>Notes/Comments:</strong> <textarea rows="3" style="width:100%"></textarea></p>
        <p>
            Mileage form sent? <input type="checkbox"> 
            Devices Unlocked? <input type="checkbox">
        </p>
        <p>Personal Contact: <input type="text"></p>
        <p>Personal Email: <input type="text"></p>
    </div>

    <div id="car" class="tab-content">
        <h2>Company Car Check Sheet</h2>
        
        <div class="grid-3">
            <div>Registration: <input type="text" style="border-bottom:1px solid #000"></div>
            <div>Driver Name: <input type="text" style="border-bottom:1px solid #000"></div>
            <div>Mileage: <input type="number" style="border-bottom:1px solid #000"></div>
            <div>Date: <input type="date" style="border-bottom:1px solid #000"></div>
            <div>Nichecom: <input type="text" style="border-bottom:1px solid #000"></div>
            <div>Manager: <input type="text" style="border-bottom:1px solid #000"></div>
        </div>

        <br>
        <p><em>Mark damage on the diagram below:</em></p>
        <div class="car-canvas-container">
            <canvas id="carCanvas"></canvas>
            <div style="position:absolute; bottom:5px; right:5px;">
                <button onclick="clearCarCanvas()" class="clear-btn">Clear Drawing</button>
            </div>
        </div>

        <h3>Internal Checks</h3>
        <table style="width:100%">
            <tr>
                <td><strong>Infotainment System Working?</strong></td>
                <td>
                   <label><input type="radio" name="info" value="yes"> Yes</label>
                   <label><input type="radio" name="info" value="no"> No</label>
                </td>
                <td>Comment: <input type="text"></td>
            </tr>
            <tr>
                <td><strong>Warning Lights (Red)</strong></td>
                <td>
                   <label><input type="radio" name="warn_red" value="yes"> Yes</label>
                   <label><input type="radio" name="warn_red" value="no"> No</label>
                </td>
                <td>Comment: <input type="text"></td>
            </tr>
            <tr>
                <td><strong>Warning Lights (Amber)</strong></td>
                <td>
                   <label><input type="radio" name="warn_amber" value="yes"> Yes</label>
                   <label><input type="radio" name="warn_amber" value="no"> No</label>
                </td>
                <td>Comment: <input type="text"></td>
            </tr>
            <tr>
                <td><strong>Service History Present?</strong></td>
                <td>Last Date/Mile: <input type="text"></td>
                <td>Next Date/Mile: <input type="text"></td>
            </tr>
        </table>
        
        <p><strong>Bodywork Comments:</strong> <input type="text" style="width:100%; border-bottom:1px solid black"></p>
        
        <h3>External / Safety Checks</h3>
        <table>
            <tr>
                <th>Item</th>
                <th>Checked</th>
                <th>Yes</th>
                <th>No / NA</th>
                <th>Action Required/Taken</th>
            </tr>
            <tr><td>Windscreen / Glass</td><td><input type="checkbox"></td><td><input type="radio" name="wind"></td><td><input type="radio" name="wind"></td><td><input type="text"></td></tr>
            <tr><td>Lights / Indicators</td><td><input type="checkbox"></td><td><input type="radio" name="light"></td><td><input type="radio" name="light"></td><td><input type="text"></td></tr>
            <tr><td>Mirrors</td><td><input type="checkbox"></td><td><input type="radio" name="mirr"></td><td><input type="radio" name="mirr"></td><td><input type="text"></td></tr>
            <tr><td>Number Plates</td><td><input type="checkbox"></td><td><input type="radio" name="plate"></td><td><input type="radio" name="plate"></td><td><input type="text"></td></tr>
            <tr><td>Tyres (1.6mm legal)</td><td><input type="checkbox"></td><td><input type="radio" name="tyre"></td><td><input type="radio" name="tyre"></td><td><input type="text"></td></tr>
            <tr><td>Locking Wheel Nut</td><td><input type="checkbox"></td><td><input type="radio" name="nut"></td><td><input type="radio" name="nut"></td><td><input type="text"></td></tr>
            <tr><td>Spare Wheel</td><td><input type="checkbox"></td><td><input type="radio" name="spare"></td><td><input type="radio" name="spare"></td><td><input type="text"></td></tr>
            <tr><td>Charging Cables</td><td><input type="checkbox"></td><td><input type="radio" name="cable"></td><td><input type="radio" name="cable"></td><td><input type="text"></td></tr>
        </table>

        <div class="grid-2">
            <div>
                <p><strong>Driver Signature:</strong></p>
                <div class="sig-wrapper">
                    <canvas id="sig-driver-car" class="sig-pad"></canvas>
                    <button class="clear-btn" onclick="clearSig('sig-driver-car')">Clear</button>
                </div>
            </div>
            <div>
                <p><strong>Manager Signature:</strong></p>
                <div class="sig-wrapper">
                    <canvas id="sig-manager-car" class="sig-pad"></canvas>
                    <button class="clear-btn" onclick="clearSig('sig-manager-car')">Clear</button>
                </div>
            </div>
        </div>
    </div>
</div>

<script>
    // --- 1. TAB LOGIC ---
    function switchTab(tabId, btnElement) {
        document.querySelectorAll('.tab-content').forEach(div => div.classList.remove('active'));
        document.querySelectorAll('.tab-btn').forEach(btn => btn.classList.remove('active'));
        document.getElementById(tabId).classList.add('active');
        btnElement.classList.add('active');
        
        // Resize canvases when tab becomes visible (needed for correct coordinate mapping)
        resizeCanvases();
    }

    // --- 2. SIGNATURE PADS ---
    const sigPads = {};
    const canvasIds = ['sig-manager-kit', 'sig-photo-kit', 'sig-driver-car', 'sig-manager-car'];
    
    // Initialize Signature Pads
    window.onload = function() {
        canvasIds.forEach(id => {
            const canvas = document.getElementById(id);
            // Handle high DPI screens
            const ratio = Math.max(window.devicePixelRatio || 1, 1);
            canvas.width = canvas.offsetWidth * ratio;
            canvas.height = canvas.offsetHeight * ratio;
            canvas.getContext("2d").scale(ratio, ratio);
            
            sigPads[id] = new SignaturePad(canvas);
        });
        
        initCarCanvas();
    };

    function clearSig(id) {
        sigPads[id].clear();
    }
    
    function resizeCanvases() {
        // Re-adjust canvas dimensions if tab switch messes them up
        canvasIds.forEach(id => {
            const canvas = document.getElementById(id);
            // Optional: retain data during resize if needed, simpler to just re-init dimensions
        });
    }

    // --- 3. CAR DIAGRAM DRAWING ---
    let carCanvas, carCtx;
    
    function initCarCanvas() {
        const container = document.querySelector('.car-canvas-container');
        carCanvas = document.getElementById('carCanvas');
        carCanvas.width = container.offsetWidth;
        carCanvas.height = container.offsetHeight;
        carCtx = carCanvas.getContext('2d');
        
        carCtx.strokeStyle = "red";
        carCtx.lineWidth = 3;
        
        let isDrawing = false;

        // Touch Events for iPad
        carCanvas.addEventListener('touchstart', (e) => {
            e.preventDefault();
            isDrawing = true;
            const rect = carCanvas.getBoundingClientRect();
            carCtx.beginPath();
            carCtx.moveTo(e.touches[0].clientX - rect.left, e.touches[0].clientY - rect.top);
        }, {passive: false});

        carCanvas.addEventListener('touchmove', (e) => {
            e.preventDefault();
            if (!isDrawing) return;
            const rect = carCanvas.getBoundingClientRect();
            carCtx.lineTo(e.touches[0].clientX - rect.left, e.touches[0].clientY - rect.top);
            carCtx.stroke();
        }, {passive: false});

        carCanvas.addEventListener('touchend', () => isDrawing = false);

        // Mouse Events for Desktop testing
        carCanvas.addEventListener('mousedown', (e) => {
            isDrawing = true;
            carCtx.beginPath();
            carCtx.moveTo(e.offsetX, e.offsetY);
        });
        carCanvas.addEventListener('mousemove', (e) => {
            if (!isDrawing) return;
            carCtx.lineTo(e.offsetX, e.offsetY);
            carCtx.stroke();
        });
        carCanvas.addEventListener('mouseup', () => isDrawing = false);
    }

    function clearCarCanvas() {
        carCtx.clearRect(0, 0, carCanvas.width, carCanvas.height);
    }

    // --- 4. PDF GENERATION ---
    function generatePDF() {
        // Determine which tab is active to name the file correctly
        const activeTab = document.querySelector('.tab-content.active');
        const filename = activeTab.id === 'kit' ? 'Kit_Handover_Checklist.pdf' : 'Car_Inspection_Sheet.pdf';

        const element = document.getElementById('printableArea');
        
        // Hide the non-active tab content temporarily for clean PDF
        const kitTab = document.getElementById('kit');
        const carTab = document.getElementById('car');
        
        // We only want to print the visible tab.
        // Save current display states
        const originalKitDisplay = kitTab.style.display;
        const originalCarDisplay = carTab.style.display;

        // Force only the active one to show (html2pdf captures the DOM element)
        // Note: html2pdf captures 'element', so we pass the specific tab div, not the whole container
        const targetElement = activeTab.id === 'kit' ? kitTab : carTab;

        const opt = {
            margin:       0.2,
            filename:     filename,
            image:        { type: 'jpeg', quality: 0.98 },
            html2canvas:  { scale: 2 },
            jsPDF:        { unit: 'in', format: 'a4', orientation: 'portrait' }
        };

        // Generate PDF
        html2pdf().set(opt).from(targetElement).save();
    }
</script>

</body>
</html>